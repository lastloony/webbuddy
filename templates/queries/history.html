{% extends 'base.html' %}

{% block title %}Query History - WebBuddy{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h2 style="color: #667eea;">Query History</h2>
    <a href="{% url 'query_create' %}" class="btn">+ New Query</a>
</div>

{% if queries %}
<div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                <th style="padding: 12px; text-align: left;">ID</th>
                <th style="padding: 12px; text-align: left;">Query Text</th>
                <th style="padding: 12px; text-align: left;">Status</th>
                <th style="padding: 12px; text-align: left;">Created</th>
                <th style="padding: 12px; text-align: left;">Finished</th>
                <th style="padding: 12px; text-align: left;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for query in queries %}
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 12px;">#{{ query.id }}</td>
                <td style="padding: 12px;">
                    <div style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        {{ query.query_text|truncatewords:20 }}
                    </div>
                </td>
                <td style="padding: 12px;">
                    <span style="padding: 4px 12px; border-radius: 4px; background: {% if query.status == 'done' %}#d4edda{% elif query.status == 'failed' %}#f8d7da{% elif query.status == 'in_progress' %}#fff3cd{% else %}#d1ecf1{% endif %}; color: {% if query.status == 'done' %}#155724{% elif query.status == 'failed' %}#721c24{% elif query.status == 'in_progress' %}#856404{% else %}#0c5460{% endif %}; font-size: 12px;">
                        {{ query.status|upper }}
                    </span>
                </td>
                <td style="padding: 12px;">{{ query.query_created|date:"Y-m-d H:i" }}</td>
                <td style="padding: 12px;">
                    {% if query.query_finished %}
                        {{ query.query_finished|date:"Y-m-d H:i" }}
                    {% else %}
                        <span style="color: #999;">-</span>
                    {% endif %}
                </td>
                <td style="padding: 12px;">
                    <a href="{% url 'query_detail' pk=query.id %}" class="btn" style="padding: 6px 12px; font-size: 14px;">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div style="text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 8px;">
    <p style="color: #666; font-size: 18px; margin-bottom: 20px;">No queries yet</p>
    <a href="{% url 'query_create' %}" class="btn">Create Your First Query</a>
</div>
{% endif %}
{% endblock %}